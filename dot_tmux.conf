# Tmux conf file
# refs:
#     - https://man7.org/linux/man-pages/man1/tmux.1.html
#     - https://arcolinux.com/everything-you-need-to-know-about-tmux-status-bar/

# =============================================================================
# 00. Basic 
# =============================================================================
#set -g default-terminal "xterm-256color"                                        # 设置内部模拟的终端类型 (保持不变)
#set -ga terminal-overrides ",*:Ss=\E[%p1%d q:Se=\E[ q"   # https://neovim.io/doc/user/tui.html#tui-cursor-tmux
#set -ga terminal-overrides ",*256col*:Tc"                                       # 开启真彩色支持，Tc是旧标准
#set -ga terminal-overrides ",*256col*:RGB"                                      # 开启真彩色支持，RGB 是 tmux 3.2 + 

set -g history-limit 10000                                                      # 增加回滚行数
set -g mode-keys vi
set -g mouse on
set -g set-clipboard on                                                         # 允许通过 OSC52 复制到系统剪贴板
set -g status-interval 1
set -sg escape-time 0

set -wg allow-rename on
set -wg automatic-rename-format '#{b:pane_current_path}'
set -wg renumber-windows on     # 关掉某个窗口后，自动重新编号

set -wg pane-base-index 1
set -wg base-index 1
set -wg detach-on-destroy off                                                   # 关闭最后一个窗口时不退出 tmux
set -wg focus-events on                                                         # 传递焦点事件给 Vim (autoread 必备)

if-shell 'which fish' 'run-shell "tmux set -g default-shell $(which fish)"'     # Shell设置 (优先使用检测到的 fish)


# =============================================================================
# 01. Style
# =============================================================================
set -g status-left " #S "                                                       # Display string (by default the session name) to the left
set -g status-right ""                                                          # Display string to the right of the status line
set -g status-style "bg=#2E3440, fg=#E5E9F0"

set -wg window-status-separator ""
set -wg window-status-current-format " #I.#W "                                  # Window index and name
set -wg window-status-current-style "fg=#2E3440,bg=#E5E9F0"
set -wg window-status-format " #I.#W "  
set -wg window-status-style "fg=#E5E9f0"
set -wg window-status-last-style "fg=#E5E9F0,bg=#666666"

set -wg message-style "bg=#2E3440, fg=#E5E9F0"
set -wg pane-active-border-style "fg=#E5E9F0"
set -wg pane-border-style "fg=#E5E9F0"


# =============================================================================
# 02. Key Mappings
# =============================================================================
bind c new-window -c "#{pane_current_path}"
bind e new-session -c "#I"

bind -n C-h switch-client -l                                                    # session 切换
bind -n C-t last-window                                                         # windows 切换

bind - splitw -v -c '#{pane_current_path}'
bind | splitw -h -c '#{pane_current_path}'

bind -n S-l next-window                                                         # bind -n S-Left next-window
bind -n S-h previous-window                                                     # bind -n S-Right previous-window

bind -r h select-pane -L
bind -r j select-pane -D
bind -r k select-pane -U
bind -r l select-pane -R


# =============================================================================
# 03. Plugins
# =============================================================================
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'                                     # tmux 常用配置
set -g @plugin 'tmux-plugins/tmux-yank'                                         # 支持内容复制至系统剪切板。可以使用使用 prefix+[ 来进入 copy mode，然后使用 y 键进行复制
set -g @plugin 'tmux-plugins/tmux-resurrect'                                    # tmux 会话保存
set -g @plugin 'tmux-plugins/tmux-continuum'

set -g @continuum-save-interval '1'
set -g @continuum-restore 'on'
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-dir '~/.tmux/resurrect'
set -g @resurrect-processes '"~nvim->nvim *"'
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-strategy-nvim 'session'

if-shell '[ -f ~/.tmux/plugins/tpm/tpm ]' 'run ~/.tmux/plugins/tpm/tpm'                          # arch/manjaro: yay -S tmux-plugin-manager
if-shell '[ -f /usr/share/tmux-plugin-manager/tpm ]' 'run /usr/share/tmux-plugin-manager/tpm'    # https://github.com/tmux-plugins/tpm
if-shell '[ -f /opt/homebrew/opt/tpm/share/tpm/tpm ]' 'run /opt/homebrew/opt/tpm/share/tpm/tpm'  # macos: brew install tpm
